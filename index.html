<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××‘×—×•×Ÿ ×¡×•×›×¨×ª - ×›× ×¡ ×—×“×©× ×•×ª</title>
    
<script src="https://cdn.tailwindcss.com"></script>
    
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ×”×’×“×¨×ª ×’×•×¤× ×™× ×•×¡×’× ×•× ×•×ª ×›×œ×œ×™×™× */
        :root {
            --primary-color: #4f46e5; /* Indigo-600 */
            --secondary-color: #1e40af; /* Blue-800 */
            --accent-color: #06b6d4; /* Cyan-500 (Neon Blue) */
            --bg-light: #f3f4f6; /* ×¨×§×¢ ×‘×”×™×¨ */
            --text-dark: #1f2937; /* ×˜×§×¡×˜ ×›×”×” ×œ×§×¨×™××•×ª */
            --text-muted: #6b7280; /* ××¤×•×¨ ×‘×™× ×•× ×™ ×œ×˜×§×¡×˜ ××©× ×™ */
            --card-bg-light: #ffffff; /* ×¨×§×¢ ×›×¨×˜×™×¡ ×œ×‘×Ÿ */
            --border-color-light: #d1d5db; /* ×’×‘×•×œ ××¤×•×¨ ×¢×“×™×Ÿ */
            --neon-glow: rgba(6, 182, 212, 0.5); /* ×–×•×”×¨ ×˜×•×¨×§×™×– ×œ×”×“×’×©×” */
        }
        
        /* ×¨×§×¢ ×¢× ××œ×× ×˜×™× ×–×–×™× */
        #animatedBackground {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 90%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            background-size: 400% 400%;
            animation: subtlePulse 30s ease infinite alternate;
        }

        @keyframes subtlePulse {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            direction: rtl; 
            line-height: 1.6;
            min-height: 100vh;
        }
        .game-container {
            max-width: 1400px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 2rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); 
            padding: 2.5rem 2rem;
            gap: 2.5rem;
            animation: fadeIn 0.8s ease-out;
            margin-top: 2rem; /* ×”×•×¡×¤×ª ×©×•×œ×™×™× ×¢×œ×™×•× ×™× ×œ×’×œ×™×œ×” */
            margin-bottom: 2rem; /* ×”×•×¡×¤×ª ×©×•×œ×™×™× ×ª×—×ª×•× ×™× ×œ×’×œ×™×œ×” */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header {
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color-light);
            margin-bottom: 2.5rem;
        }
        h1 {
            color: var(--primary-color);
            font-weight: 800; 
            letter-spacing: -0.04em;
            line-height: 1.1;
        }
        .header-subtext {
            color: var(--text-muted);
            font-weight: 500;
        }

        /* ×›×¨×˜×™×¡ ×”×’×“×¨×•×ª - ×§×•× ×˜×¨×¡×˜ ×’×‘×•×” */
        .definition-card {
            cursor: grab;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, border-color 0.3s ease-out, opacity 0.3s;
            background-color: var(--card-bg-light); 
            border: 2px solid var(--primary-color); 
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1), 0 0 8px rgba(79, 70, 229, 0.3);
            padding: 2.5rem;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            color: var(--text-dark);
            animation: slideInUp 0.6s ease-out;
            touch-action: none; /* ×§×¨×™×˜×™ ×œ××•×‘×™×™×œ: ××•× ×¢ ××™×¨×•×¢×™ ×“×¤×“×¤×Ÿ ×‘×¨×™×¨×ª ××—×“×œ */
        }
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .definition-card:active, .is-dragging {
            cursor: grabbing;
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25), 0 0 15px var(--accent-color);
            border-color: var(--accent-color);
        }
        .definition-card.is-dragging {
            opacity: 0.9;
        }
        .definition-card span.text-xl {
            color: var(--accent-color);
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: none;
        }
        .definition-card p {
            font-size: 1.35rem; 
            line-height: 1.7;
            color: var(--text-dark); 
        }

        /* ×™×¢×“×™ ×’×¨×™×¨×” (×”×“××•×™×•×ª) - ×¢×™×¦×•×‘ ×‘×•×œ×˜ ×™×•×ª×¨ */
        .character-target {
            transition: transform 0.25s ease-out, box-shadow 0.25s ease-out, background-color 0.25s ease-out, border-color 0.25s ease-out;
            border: 3px solid var(--primary-color); 
            background-color: var(--card-bg-light); 
            border-radius: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2); 
            opacity: 1;
            cursor: default;
            padding: 1.5rem;
            min-height: 180px;
            color: var(--text-dark);
        }
        .character-target:hover {
            transform: translateY(-5px); 
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 0 15px var(--neon-glow);
            border-color: var(--accent-color);
        }
        .character-target .text-5xl { 
            font-size: 5rem;
            margin-bottom: 0.75rem;
            line-height: 1;
        }
        .character-target p.text-lg { 
            color: var(--secondary-color); 
            font-weight: 800;
            margin-top: 0.5rem;
            font-size: 1.3rem;
        }
        .character-target p.text-sm { 
            color: var(--text-muted);
            font-weight: 400;
            margin-top: 0.25rem;
        }

        /* ×¡×’× ×•×Ÿ ×›×©×”×›×¨×˜×™×¡ × ×’×¨×¨ ××¢×œ ×”×™×¢×“ */
        .drag-over {
            transform: scale(1.08) translateY(-8px); 
            box-shadow: 0 0 30px 10px var(--neon-glow), inset 0 0 0 3px var(--accent-color); 
            border-color: var(--accent-color) !important;
            opacity: 1;
            background-color: #e0f7fa !important;
        }

        /* ×¡×’× ×•×Ÿ ×”×‘×–×§ ××—×™×“ (×¡×™××•×Ÿ ×©×”×‘×—×™×¨×” × ×§×œ×˜×”) */
        .character-target.success-flash {
            animation: flash-effect 0.4s ease-out;
            border-color: var(--accent-color);
            background-color: #e0f7fa;
            box-shadow: 0 0 20px 8px var(--neon-glow);
        }
        
        @keyframes flash-effect {
            0% { transform: scale(0.98); opacity: 0.9; box-shadow: 0 0 15px 5px var(--neon-glow); }
            50% { transform: scale(1.03); opacity: 1; box-shadow: 0 0 25px 8px var(--neon-glow); }
            100% { transform: scale(1); opacity: 1; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        }

        /* ××“ ×”×ª×§×“××•×ª */
        #progressBarContainer {
            background-color: var(--border-color-light);
            border-radius: 9999px;
            height: 10px;
            box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.1);
        }
        #progressBar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            border-radius: 9999px;
            box-shadow: 0 0 5px var(--accent-color); 
        }
        #progressText {
            color: var(--text-muted);
            font-weight: 500;
            margin-top: 0.75rem;
            font-size: 1rem;
        }

        /* ××•×“××œ ×ª×•×¦××•×ª - × ×©××¨ ×›×”×” ×œ××¤×§×˜ ×“×¨××˜×™ */
        .results-modal {
            background-color: rgba(0, 0, 0, 0.9);
        }
        .results-card {
            background: #1e293b;
            border-radius: 2rem;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8), inset 0 0 0 2px var(--accent-color);
            padding: 3rem;
            color: white;
            animation: modalPopIn 0.5s ease-out;
        }
        @keyframes modalPopIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .results-card h2 {
            color: var(--primary-color);
            font-weight: 800;
            text-shadow: 0 0 15px rgba(99, 102, 241, 0.8);
        }
        .results-card p#finalScore {
            color: var(--accent-color);
            font-weight: 800;
            font-size: 5rem;
            letter-spacing: 0.1em;
            margin-bottom: 2.5rem;
            text-shadow: 0 0 25px var(--accent-color);
        }
        .results-card button#restartButton {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)) !important;
            color: white !important;
            font-weight: 700;
            padding: 1rem 2.5rem;
            border-radius: 9999px;
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.5);
            transition: all 0.3s ease-in-out;
            border: none;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        .results-card button#restartButton:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(79, 70, 229, 0.6), 0 0 20px var(--accent-color);
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)) !important; 
        }


        /* ×”×ª×××•×ª ×œ××•×‘×™×™×œ (××¡×›×™× ×§×˜× ×™× ×-640px) */
        @media (max-width: 639px) {
            .game-container {
                gap: 1.5rem; 
                padding: 1.5rem 1rem;
            }
            header {
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
            }
            h1 {
                font-size: 2.5rem; 
            }
            .header-subtext {
                font-size: 1rem;
            }
            .definition-card {
                padding: 1rem;
                min-height: 160px;
            }
            .definition-card span.text-xl {
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }
            .definition-card p {
                font-size: 1.05rem; /* ×’×•×“×œ ×’×•×¤×Ÿ × ×•×— ×œ×§×¨×™××” ×‘××•×‘×™×™×œ */
                line-height: 1.4;
            }
            
            /* *** ×ª×™×§×•×Ÿ ×§×¨×™×˜×™: ××¢×‘×¨ ×œ×˜×•×¨ ×™×—×™×“ ×‘××•×‘×™×™×œ *** */
            #targetsArea {
                grid-template-columns: 1fr; /* ×˜×•×¨ ×™×—×™×“ ×œ×¨×•×—×‘ ××œ× */
                gap: 1rem; /* ×¨×•×•×— × ×“×™×‘ ×‘×™×Ÿ ×”×™×¢×“×™× */
                margin-top: 1.5rem;
            }
            .character-target {
                min-height: 120px; 
                padding: 1rem;
            }
            .character-target .text-5xl { 
                font-size: 3.5rem; /* ×××•×’'×™ ×’×“×•×œ ×•×‘×¨×•×¨ */
            }
            .character-target p.text-lg { 
                font-size: 1.1rem; /* ×©× ×”×¡×•×›×¨×ª ×’×“×•×œ ×•×‘×¨×•×¨ */
            }
            .character-target p.text-sm {
                font-size: 0.85rem;
            }
            .results-card {
                padding: 2rem;
            }
            .results-card h2 {
                font-size: 2.5rem;
            }
            .results-card p#finalScore {
                font-size: 3.5rem;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    
<div id="animatedBackground"></div>

    <div id="gameContainer" class="game-container mx-auto flex flex-col items-center">
        <header class="text-center w-full">
            <h1 class="text-5xl sm:text-6xl mb-4">××‘×—×•×Ÿ ×¡×•×›×¨×ª</h1>
            <p class="text-xl sm:text-2xl header-subtext">×’×¨×•×¨ ××ª ×”×’×“×¨×ª ×”×¡×•×›×¨×ª ××œ ×¡×•×’ ×”×¡×•×›×¨×ª ×”××ª××™× ×”××•×¤×™×¢ ×œ××˜×”</p>
        </header>

        
<div id="definitionArea" class="w-full max-w-3xl rounded-3xl min-h-[300px] flex justify-center items-center">
            <div id="currentDefinition"
                 class="definition-card w-full text-text-color-primary text-lg font-medium"
                 draggable="true">
                
</div>
        </div>

        
<div class="w-full max-w-3xl mt-6">
            <div id="progressBarContainer" class="h-2 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
            <p id="progressText" class="text-center mt-2">0/5 ×”×•×©×œ××•</p>
        </div>


        
<div id="targetsArea" class="w-full grid grid-cols-2 md:grid-cols-5 gap-6 mt-10">
            
</div>
    </div>

    
<div id="resultsModal" class="results-modal fixed inset-0 flex items-center justify-center p-4 hidden z-[100]">
        <div class="results-card w-full max-w-md text-center">
            <h2 class="text-4xl font-extrabold mb-4">×”××©×—×§ ×”×¡×ª×™×™×!</h2>
            <p id="feedbackText" class="text-xl text-text-color-secondary mb-6">×”×§×•×“ ×”×¡×•×“×™ ×©×œ×š ×”×•×:</p>
            <p id="finalScore" class="text-5xl font-bold mb-8">DiaXXXX</p>
            <button id="restartButton" class="font-bold py-3 px-6 rounded-full shadow-xl">
                ×©×—×§ ×©×•×‘
            </button>
        </div>
    </div>

    <script>
        // ×”×’×“×¨×ª × ×ª×•× ×™ ×”××©×—×§ ×”××§×•×¨×™×™× (5 ×”×’×“×¨×•×ª, 1 ×œ×›×œ ×¡×•×’)
        const definitionsData = [
            // ×¡×•×›×¨×ª ×¡×•×’ 1 (××™×© ×¨×–×”)
            {
                type: "×¡×•×›×¨×ª ×¡×•×’ 1",
                label: "(Type 1)",
                definition: "××—×œ×” ××•×˜×•××™××•× ×™×ª ×”×××•×¤×™×™× ×ª ×‘×”×¨×¡ ×ª××™ ×‘×˜× ×‘×œ×‘×œ×‘, ×”×’×•×¨× ×œ×—×•×¡×¨ ××•×—×œ×˜ ××• ×›××¢×˜ ××•×—×œ×˜ ×‘××™× ×¡×•×œ×™×Ÿ. ×œ×¨×•×‘ ××ª×¤×ª×—×ª ×‘×™×œ×“×™× ×•×‘×¦×¢×™×¨×™×, ××š ×™×›×•×œ×” ×œ×”×•×¤×™×¢ ×‘×›×œ ×’×™×œ. × ×“×¨×©×ª ×˜×™×¤×•×œ ×‘××™× ×¡×•×œ×™×Ÿ ×œ×›×œ ×”×—×™×™×. ×××•×¤×™×™× ×ª ×‘× ×•×›×—×•×ª × ×•×’×“× ×™× ×¢×¦××™×™× (×œ××©×œ GAD, IA-2, ZnT8) ×•×‘× ×˜×™×™×” ×œ×§×˜×•××¦×™×“×•×–×™×¡.",
                emoji: "ğŸƒâ€â™‚ï¸" 
            },
            // ×¡×•×›×¨×ª ×¡×•×’ 2 (××™×© ×©××Ÿ ××¨×™× ××©×§×•×œ×•×ª)
            {
                type: "×¡×•×›×¨×ª ×¡×•×’ 2",
                label: "(Type 2)",
                definition: "××—×œ×” ××˜×‘×•×œ×™×ª ×”×××•×¤×™×™× ×ª ×‘×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ, ×œ×¨×•×‘ ××¦×œ ××‘×•×’×¨×™×, ××š ×©×›×™×—×•×ª×” ×¢×•×œ×” ×’× ×‘×’×™×œ ×¦×¢×™×¨. ×§×©×•×¨×” ×œ×”×©×× ×” ×•×œ×’×•×¨××™× ×’× ×˜×™×™×, ×•××˜×•×¤×œ×ª ×œ×¨×•×‘ ×‘×©×™× ×•×™ ××•×¨×— ×—×™×™× ×•×ª×¨×•×¤×•×ª ×¤×•××™×•×ª, ×•×œ×¢×™×ª×™× ×‘××™× ×¡×•×œ×™×Ÿ.",
                emoji: "ğŸ‹ï¸â€â™‚ï¸" // ××™××•×’'×™ ×—×“×©: ××“× ××¨×™× ××©×§×•×œ×•×ª
            },
            // MODY (××™×©×” ×××•×¦×¢×ª)
            {
                type: "MODY",
                label: "(MODY)",
                definition: "×¡×•×›×¨×ª ××•× ×•×’× ×™×ª, ×œ×¨×•×‘ ×¢× ×”×•×¤×¢×” ×‘×’×™×œ ×¦×¢×™×¨ (×œ×¤× ×™ ×’×™×œ 25), ×”× ×’×¨××ª ×××•×˜×¦×™×” ×’× ×˜×™×ª ×‘×’×Ÿ ×™×—×™×“, ×•×××•×¤×™×™× ×ª ×‘×”×¤×¨×¢×” ×‘×”×¤×¨×©×ª ××™× ×¡×•×œ×™×Ÿ ×œ×œ× ×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ. ××•×¢×‘×¨×ª ×‘×ª×•×¨×©×” ××•×˜×•×–×•××œ×™×ª ×“×•××™× × ×˜×™×ª, ×•×œ×¨×•×‘ ××™× ×” ×“×•×¨×©×ª ×˜×™×¤×•×œ ×‘××™× ×¡×•×œ×™×Ÿ.",
                emoji: "ğŸ‘©"
            },
            // LADA (××™×©×” ×¨×–×”)
            {
                type: "LADA",
                label: "(LADA)",
                definition: "×¡×•×›×¨×ª ××•×˜×•××™××•× ×™×ª ×¢× ×”×•×¤×¢×” ×‘×’×™×œ ××‘×•×’×¨ (×œ×¨×•×‘ ××¢×œ ×’×™×œ 30), ×‘×¢×œ×ª ×××¤×™×™× ×™× ×§×œ×™× ×™×™× ×©×œ ×¡×•×›×¨×ª ×¡×•×’ 2 ××š ×¢× × ×•×›×—×•×ª × ×•×’×“× ×™× ×¢×¦××™×™×. ××ª××¤×™×™× ×ª ×‘×”×ª×§×“××•×ª ××™×˜×™×ª ×™×—×¡×™×ª ×œ×—×•×¡×¨ ××™× ×¡×•×œ×™×Ÿ, ×•×œ×¢×™×ª×™× × ×“×¨×©×ª ×˜×™×¤×•×œ ×‘××™× ×¡×•×œ×™×Ÿ ×ª×•×š ××¡×¤×¨ ×©× ×™×.",
                emoji: "ğŸ§˜â€â™€ï¸"
            },
            // ×¡×•×›×¨×ª ×”×¨×™×•×Ÿ (××™×©×” ×‘×”×¨×™×•×Ÿ)
            {
                type: "×¡×•×›×¨×ª ×”×¨×™×•×Ÿ",
                label: "(Gestational)",
                definition: "××¦×‘ ×©×œ ×”×™×¤×¨×’×œ×™×§××™×” ×”×××•×‘×—×Ÿ ×œ×¨××©×•× ×” ×‘××”×œ×š ×”×”×¨×™×•×Ÿ, ×©××™× ×• ×¢×•××“ ×‘×§×¨×™×˜×¨×™×•× ×™× ×©×œ ×¡×•×›×¨×ª ×˜×¨×•×-×”×¨×™×•×Ÿ. ×œ×¨×•×‘ ××ª×¤×ª×— ×‘×©×œ ×¢××™×“×•×ª ×œ××™× ×¡×•×œ×™×Ÿ ×¤×™×–×™×•×œ×•×’×™×ª ×‘×”×¨×™×•×Ÿ, ×›××©×¨ ×”×œ×‘×œ×‘ ××™× ×• ××¦×œ×™×— ×œ×”×¤×¨×™×© ××¡×¤×™×§ ××™× ×¡×•×œ×™×Ÿ. ×××•×‘×—×Ÿ ×‘×××¦×¢×•×ª ×”×¢××¡×ª ×¡×•×›×¨ (OGTT) ×•××˜×•×¤×œ ×‘×©×™× ×•×™ ××•×¨×— ×—×™×™× ×•×œ×¢×™×ª×™× ×‘××™× ×¡×•×œ×™×Ÿ",
                emoji: "ğŸ¤°"
            }
        ];

        // ××©×ª× ×™ ××¦×‘ ×”××©×—×§
        let gameData = []; // ×”× ×ª×•× ×™× ×”××¢×•×¨×‘×‘×™× ×•×”××¢×•×“×›× ×™×
        let currentDefinitionIndex = 0;
        let score = 0; // ×”× ×™×§×•×“ × ×¡×¤×¨ ×‘××•×¤×Ÿ ×¡××•×™
        let isGameActive = false;
        let dragTargetType = null; 
        
        // ××©×ª× ×™ ××¦×‘ ××’×¢ (Touch)
        let isDraggingTouch = false;
        let touchStartX, touchStartY;
        let originalCardRect; // ×œ×©×™××•×¨ ××™×§×•× ×”×›×¨×˜×™×¡ ×”××§×•×¨×™

        // ××œ×× ×˜×™× DOM
        const definitionArea = document.getElementById('definitionArea');
        const currentDefinitionEl = document.getElementById('currentDefinition');
        const targetsArea = document.getElementById('targetsArea');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const resultsModal = document.getElementById('resultsModal');
        const finalScoreEl = document.getElementById('finalScore');
        const feedbackTextEl = document.getElementById('feedbackText');
        const restartButton = document.getElementById('restartButton');
        const TOTAL_DEFINITIONS = definitionsData.length; // 5

        /**
         * ××¢×¨×‘×‘ ××¢×¨×š ×‘××•×¤×Ÿ ××§×¨××™ (××œ×’×•×¨×™×ª× Fisher-Yates)
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        /**
         * ×¢×“×›×•×Ÿ ××“ ×”×”×ª×§×“××•×ª ×•×”×˜×§×¡×˜ ×”× ×œ×•×•×”
         */
        function updateProgress() {
            const completed = currentDefinitionIndex;
            const percentage = (completed / TOTAL_DEFINITIONS) * 100;

            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${completed}/${TOTAL_DEFINITIONS} ×”×•×©×œ××•`;
        }

        /**
         * ×”×¦×’×ª ×”×”×’×“×¨×” ×”× ×•×›×—×™×ª
         */
        function displayCurrentDefinition() {
            if (currentDefinitionIndex < TOTAL_DEFINITIONS) {
                const currentData = gameData[currentDefinitionIndex];
                currentDefinitionEl.innerHTML = `<span class="text-xl">×”×’×“×¨×” ××¡×¤×¨ ${currentDefinitionIndex + 1}</span><p class="mt-4">${currentData.definition}</p>`;
                currentDefinitionEl.setAttribute('data-type', currentData.type); 
                currentDefinitionEl.classList.remove('hidden');
                
                // ×•×“× ×©×”×›×¨×˜×™×¡ ×©×•×‘ × ×™×ª×Ÿ ×œ×’×¨×•×¨ ×•×©××§×•××• ×©×•×—×–×¨ ×œ××—×¨ ×¡×™×•× ×’×¨×™×¨×” ×§×•×“××ª (×‘××™×•×—×“ ×‘××’×¢)
                currentDefinitionEl.style.transform = '';
                currentDefinitionEl.style.position = '';
                currentDefinitionEl.style.top = '';
                currentDefinitionEl.style.left = '';
                currentDefinitionEl.style.width = '';
                currentDefinitionEl.style.zIndex = '';
                currentDefinitionEl.style.transition = '';
            } else {
                // ×”×¡×ª×¨×ª ×›×¨×˜×™×¡ ×”×’×¨×™×¨×” ×•×”×¦×’×ª ×”×•×“×¢×ª ×¡×™×•× ×‘××–×•×¨ ×”×”×’×“×¨×”
                currentDefinitionEl.classList.add('hidden');
                definitionArea.innerHTML = `<p class="text-2xl font-semibold text-text-muted">×›×œ ×”×›×‘×•×“! ×¡×™×™××ª ××ª ×›×œ ×”×”×’×“×¨×•×ª.</p>`;
                endGame();
            }
        }

        /**
         * ××ª×—×•×œ ×™×¢×“×™ ×”×’×¨×™×¨×” (×”×“××•×™×•×ª)
         */
        function initTargets() {
            targetsArea.innerHTML = '';
            // ×™×¦×™×¨×ª ××¢×¨×š ×©×œ ×™×¢×“×™× ×™×™×—×•×“×™×™× (5 ×¡×•×’×™ ×¡×•×›×¨×ª)
            const uniqueTargets = definitionsData.filter((item, index, self) => 
                index === self.findIndex((t) => (
                    t.type === item.type
                ))
            );
            
            const shuffledTargets = shuffleArray(uniqueTargets); 
            
            shuffledTargets.forEach(data => {
                const targetEl = document.createElement('div');
                targetEl.id = `target-${data.type.replace(/\s/g, '-')}`;
                targetEl.setAttribute('data-type', data.type);
                targetEl.classList.add('character-target', 'flex', 'flex-col', 'items-center', 'justify-center', 'text-center');

                targetEl.innerHTML = `
                    <div class="text-5xl mb-2">${data.emoji}</div>
                    <p class="text-lg font-bold">${data.type}</p>
                    <p class="text-sm">${data.label}</p>
                `;

                // ×”×•×¡×¤×ª ×××–×™× ×™ ××™×¨×•×¢×™ ×’×¨×™×¨×” (Desktop)
                targetEl.addEventListener('dragover', handleDragOver);
                targetEl.addEventListener('dragleave', handleDragLeave);
                targetEl.addEventListener('drop', handleDrop);
                
                targetsArea.appendChild(targetEl);
            });
            
        }

        /**
         * ×”×ª×—×œ×ª ×”××©×—×§: ××™×¤×•×¡ ××¦×‘, ×¢×¨×‘×•×‘ × ×ª×•× ×™× ×•×”×¦×’×ª ×”×”×’×“×¨×” ×”×¨××©×•× ×”
         */
        function startGame() {
            score = 0;
            currentDefinitionIndex = 0;
            isGameActive = true;
            
            // ×©×—×–×•×¨ ××‘× ×” definitionArea ×›×“×™ ×œ××¤×©×¨ ××©×—×§ ×—×•×–×¨
            if (!definitionArea.contains(currentDefinitionEl)) {
                definitionArea.innerHTML = ''; // ×× ×§×” ×”×•×“×¢×ª ×¡×™×•×
                definitionArea.appendChild(currentDefinitionEl);
            }
            currentDefinitionEl.classList.remove('hidden'); 
            
            // ×™×¦×™×¨×ª ×¢×•×ª×§ ××¢×•×¨×‘×‘ ×©×œ 5 ×”×”×’×“×¨×•×ª
            gameData = shuffleArray([...definitionsData]); 

            // ××™×¤×•×¡ ×™×¢×“×™× ×•×”×¦×’×ª×
            initTargets();
            
            // ×”×¦×’×ª ×”×”×’×“×¨×” ×”×¨××©×•× ×”
            displayCurrentDefinition();
            updateProgress();
            
            resultsModal.classList.add('hidden');
        }

        /**
         * ×¡×™×•× ×”××©×—×§ ×•×”×¦×’×ª ×”×§×•×“ ×”×¡×•×“×™
         */
        function endGame() {
            isGameActive = false;
            
            // ×”××¨×” ×©×œ ×”×¦×™×•×Ÿ (××¡×¤×¨ ×”×ª×××•×ª × ×›×•× ×•×ª ××ª×•×š 5) ×œ×§×•×“ ×¡×•×“×™
            let finalCode = '';
            
            // ×”× ×™×§×•×“ ×”×•× ×-0 ×¢×“ 5
            if (score === 5) {
                finalCode = 'Dia2001'; // 100%
            } else if (score === 4) {
                finalCode = 'Dia2008'; // 80%
            } else if (score === 3) {
                finalCode = 'Dia2006'; // 60%
            } else if (score === 2) {
                finalCode = 'Dia2004'; // 40%
            } else {
                // 0 ××• 1
                finalCode = 'Dia2002'; // 0%-20%
            }
            
            // ×¢×“×›×•×Ÿ ×”-DOM ×œ×”×¦×’×ª ×”×§×•×“
            finalScoreEl.textContent = finalCode;
            feedbackTextEl.textContent = "×¡×™×™××ª ××ª ×”××‘×—×Ÿ! ×”×§×•×“ ×”×¡×•×“×™ ×©×œ×š ×”×•×:";

            resultsModal.classList.remove('hidden');
        }

        /**
         * ×¤×•× ×§×¦×™×™×ª ×œ×™×‘×” ×œ×¢×™×‘×•×“ ××™×¨×•×¢ ×©×—×¨×•×¨ (××©×•×ª×¤×ª ×œ-Drop ×•×œ-Touch End)
         */
        function processDrop(targetEl, draggedType) {
            if (!targetEl) return;

            const targetType = targetEl.getAttribute('data-type'); 
            let isCorrect = (draggedType === targetType);

            // 1. ×‘×“×™×§×ª × ×›×•× ×•×ª ×•×¢×“×›×•×Ÿ ×”×¦×™×•×Ÿ ×‘××•×¤×Ÿ ×¡××•×™
            if (isCorrect) {
                score++;
            } 

            // 2. ×¡×™××•×Ÿ ××—×™×“ ×§×¦×¨ ×œ×œ× ×’×™×œ×•×™ × ×›×•× ×•×ª (×¨×§ ×›×“×™ ×œ×¡××Ÿ ×©×”××™×¨×•×¢ × ×§×œ×˜)
            targetEl.classList.add('success-flash'); 
            
            // ×”×¡×¨×ª ×”×¡×™××•×Ÿ ×œ××—×¨ ×”×©×”×™×” ×§×¦×¨×” (0.5 ×©× ×™×•×ª)
            setTimeout(() => {
                targetEl.classList.remove('success-flash');
            }, 500); 
            
            // 3. ×”×ª×§×“××•×ª ××™×™×“×™×ª ×œ×©××œ×” ×”×‘××” (×‘×›×œ ××¦×‘)
            currentDefinitionIndex++;
            displayCurrentDefinition();
            updateProgress();
        }


        // --- ××˜×¤×œ×™ ××™×¨×•×¢×™ ×’×¨×™×¨×” ×•×©×—×¨×•×¨ (Drag and Drop Handlers - Desktop) ---

        function handleDragStart(e) {
            if (!isGameActive) return;
            dragTargetType = e.target.getAttribute('data-type');
            e.dataTransfer.setData('text/plain', dragTargetType);
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault(); 
            const targetEl = e.target.closest('.character-target');
            if (targetEl) {
                e.dataTransfer.dropEffect = 'move';
                targetEl.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.target.closest('.character-target')?.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetEl = e.target.closest('.character-target');
            
            if (!targetEl) return;
            
            // ×”×¡×¨×ª ××¤×§×˜ ×”×’×¨×™×¨×” ×”×•×•×™×–×•××œ×™ (drag-over)
            targetEl.classList.remove('drag-over');

            // ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×”×œ×™×‘×”
            processDrop(targetEl, dragTargetType);
        }

        // --- ××˜×¤×œ×™ ××™×¨×•×¢×™ ××’×¢ (Touch Handlers - Mobile/Tablet) ---

        // Helper to find the element currently under the touch point
        function getTargetElementFromTouch(e) {
            const touch = e.changedTouches[0] || e.touches[0];
            // ×©×™××•×© ×‘-elementFromPoint ×›×“×™ ×œ××¦×•× ××ª ×”××œ×× ×˜ ×©××ª×—×ª ×œ××¦×‘×¢
            const targetEl = document.elementFromPoint(touch.clientX, touch.clientY);
            // ×”×—×–×¨×ª ×”×™×¢×“ ×¨×§ ×× ×”×•× ××œ×× ×˜ ×’×¨×™×¨×”
            return targetEl ? targetEl.closest('.character-target') : null;
        }

        function handleTouchStart(e) {
            if (!isGameActive || e.touches.length !== 1) return;
            e.preventDefault(); // ××•× ×¢ ×’×œ×™×œ×”/×–×•× ×›×“×™ ×œ×”×ª×—×™×œ ×‘×’×¨×™×¨×”

            isDraggingTouch = true;
            dragTargetType = e.target.getAttribute('data-type');
            
            // ×©××™×¨×ª ××™×§×•× ××§×•×¨×™ ×•× ×§×•×“×ª ×”×ª×—×œ×”
            originalCardRect = currentDefinitionEl.getBoundingClientRect();
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            
            // ××¢×‘×¨ ×œ××™×§×•× ×§×‘×•×¢ (fixed) ×›×“×™ ×œ××¤×©×¨ ×’×¨×™×¨×” ××—×•×¥ ×œ×§×•× ×˜×™×™× ×¨
            currentDefinitionEl.style.position = 'fixed';
            currentDefinitionEl.style.top = originalCardRect.top + 'px';
            currentDefinitionEl.style.left = originalCardRect.left + 'px';
            currentDefinitionEl.style.width = originalCardRect.width + 'px';
            currentDefinitionEl.style.zIndex = 1000;
            currentDefinitionEl.classList.add('is-dragging');
        }

        function handleTouchMove(e) {
            if (!isDraggingTouch || e.touches.length !== 1) return;
            e.preventDefault(); // ××•× ×¢ ×’×œ×™×œ×” ×‘××”×œ×š ×ª× ×•×¢×ª ×”××’×¢

            const touch = e.touches[0];
            const deltaX = touch.clientX - touchStartX;
            const deltaY = touch.clientY - touchStartY;
            
            // ×”×–×–×ª ×”×›×¨×˜×™×¡ ×¢× ×”××¦×‘×¢
            currentDefinitionEl.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
            
            // ×‘×“×™×§×” ×•×™×–×•××œ×™×ª: ×¡×™××•×Ÿ ×”×™×¢×“ ×©× ××¦× ××ª×—×ª ×œ××¦×‘×¢
            const targetEl = getTargetElementFromTouch(e);
            
            // ×”×¡×¨×ª ×¡×™××•×Ÿ ××›×œ ×”×™×¢×“×™×
            document.querySelectorAll('.character-target').forEach(t => t.classList.remove('drag-over'));
            
            if (targetEl) {
                targetEl.classList.add('drag-over');
            }
        }

        function handleTouchEnd(e) {
            if (!isDraggingTouch) return;
            isDraggingTouch = false;
            
            // ××¦×™××ª ×”×™×¢×“ ×‘× ×§×•×“×ª ×”×©×—×¨×•×¨
            const targetEl = getTargetElementFromTouch(e);
            
            // ×”×¡×¨×ª ×¡×’× ×•×Ÿ ×”×’×¨×™×¨×”
            currentDefinitionEl.classList.remove('is-dragging');
            document.querySelectorAll('.character-target').forEach(t => t.classList.remove('drag-over'));

            if (targetEl) {
                // ×©×—×¨×•×¨ ××•×¦×œ×—: ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×”×œ×™×‘×”
                processDrop(targetEl, dragTargetType);
            }
            
            // ×‘×›×œ ××§×¨×” (×©×—×¨×•×¨ ××•×¦×œ×— ××• ×œ×), ×”×—×–×¨×ª ×”×›×¨×˜×™×¡ ×œ××§×•××• ×”××§×•×¨×™
            currentDefinitionEl.style.transition = 'transform 0.3s ease-out';
            currentDefinitionEl.style.transform = 'none';
            
            setTimeout(() => {
                // ××™×¤×•×¡ ×¡×’× ×•× ×•×ª ×”-fixed ×œ××—×¨ ×”×× ×™××¦×™×”
                currentDefinitionEl.style.position = '';
                currentDefinitionEl.style.top = '';
                currentDefinitionEl.style.left = '';
                currentDefinitionEl.style.width = '';
                currentDefinitionEl.style.zIndex = '';
                currentDefinitionEl.style.transition = '';
            }, 300);
            
            dragTargetType = null;
        }

        // --- ××ª×—×•×œ ×•×”×¤×¢×œ×ª ×”××©×—×§ ---

        window.onload = function() {
            startGame();
            restartButton.addEventListener('click', startGame);

            // ×”×•×¡×¤×ª ×××–×™× ×™ ××™×¨×•×¢×™ ×’×¨×™×¨×” (Desktop)
            currentDefinitionEl.addEventListener('dragstart', handleDragStart);

            // ×”×•×¡×¤×ª ×××–×™× ×™ ××™×¨×•×¢×™ ××’×¢ (Mobile/Tablet)
            currentDefinitionEl.addEventListener('touchstart', handleTouchStart, { passive: false });
            currentDefinitionEl.addEventListener('touchmove', handleTouchMove, { passive: false });
            currentDefinitionEl.addEventListener('touchend', handleTouchEnd);
        };
        
    </script>
</body>
</html>
